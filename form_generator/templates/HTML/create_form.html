<!DOCTYPE html>
<html>
<head>
    <style>
        * {
            box-sizing: border-box;
        }

        input[type=text], select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }

        label {
            padding: 12px 12px 12px 0;
            display: inline-block;
        }

        input[type=submit] {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }

        input[type=submit]:hover {
            background-color: #45a049;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even){background-color: #f2f2f2}

        th {
            background-color: #4CAF50;
            color: white;
        }

        .container {
            border-radius: 5px;
            background-color: #f2f2f2;
            padding: 20px;
        }

        .col-25 {
            float: left;
            width: 25%;
            margin-top: 6px;
        }

        .col-75 {
            float: left;
            width: 75%;
            margin-top: 6px;
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }
        
        @media screen and (max-width: 600px) {
            .col-25, .col-75, input[type=submit] {
                width: 100%;
                margin-top: 0;
            }
        }
    </style>
</head>
<body>

    <h2>Create Form</h2>

    <div class="container">
        <form action="/action_page.php">
            <div class="row">
                <div class="col-25">
                    <label for="title">Title</label>
                </div>
                <div class="col-75">
                    <input type="text" id="title" name="title" placeholder="Form title ...">
                </div>
            </div>
        
            <div class="row">
                <div class="col-25">
                    <label for="description">Description</label>
                </div>
                <div class="col-75">
                    <textarea id="description" name="description" placeholder="Write something.." style="height:200px"></textarea>
                </div>
            </div>
            <div>              
                <input id="enable-f" type="checkbox" checked="checked">
                <label for="enable-f">Enable</label>              
                <input id="visible-f" type="checkbox" checked="checked">
                <label for="visible-f">Visible</label>
            </div>
        </form>
        <br><br>
        
        <h2>Fields</h2>
        <table id="myTable">
            <tr>
                <th>Name</th>
                <th>Label</th>
                <th>Type</th>
                <th>Required</th>
                <th>Visible</th>
                <th>description</th>
                <th>min_value</th>
                <th>max_value</th>
                <th>default_value</th>
                <th>PlaceHolder</th>
            </tr>    
        </table>
        <br><br>

        <div class="row">
            <button onclick="localFieldContent()">Create row</button>
            <button onclick="delete_row()">Delete row</button>
        </div>
        <div class="row">
            <input type="submit" value="Submit" onclick="send_data()">
        </div>

    </div>
    <p id="x"></p>
    <script>
        function localFieldContent(){
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var myObj = JSON.parse(this.responseText);
                    table = create_field_table(myObj)
                    // document.getElementById("x").innerHTML =  JSON.stringify(myObj);
                }
            };
            var url = "http://127.0.0.1:8000/field/";
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }
        function create_field_table(data) {
            var table = document.getElementById("myTable");
            var row = table.insertRow(1);
            var name = row.insertCell(0);
            var label = row.insertCell(1);
            var type = row.insertCell(2);
            var required = row.insertCell(3);
            var visible = row.insertCell(4);
            var description = row.insertCell(5);
            var min_value = row.insertCell(6);
            var max_value = row.insertCell(7);
            var default_value = row.insertCell(8);
            var placeholder = row.insertCell(9);

            name.innerHTML = '<input id="name" type="text">';
            label.innerHTML = '<input id="label" type="text">';
            type.innerHTML = make_selector_field(data);
            required.innerHTML = '<input id="required" type="checkbox">';
            visible.innerHTML = '<input id="visible" type="checkbox" checked="checked">';
            description.innerHTML = '<input id="desc" type="text">';
            min_value.innerHTML = '<input id="minv" type="text">';
            max_value.innerHTML = '<input id="maxv" type="text">';
            default_value.innerHTML = '<input id="defv" type="text">';
            placeholder.innerHTML = '<input id="palceholder" type="text">';
        
        }
        function make_selector_field(data){
            select = '<select id="field" name="field">';
            for(i=0; i<data.length; i++){
                select += '<option ' + '" value="' + data[i].id +  '">' +
                        data[i].field_type +
                        '</option>';
            }
            select += '</select>';
            return select;
        }
        function delete_row() {
            document.getElementById("myTable").deleteRow(-1);
        }
        function send_data(){
            var form_title = document.getElementById("title").value;
            var form_desc = document.getElementById("description").value;
            var form_enable =  get_value("enable-f");
            var form_visible =  get_value("visible-f");
            var fields = get_field_data()
            var form ={
                "title": form_title,
                "slug": "slug_1",
                "visible": form_visible,
                "enable": form_enable,
                "description": form_desc,
                "fields": fields
            }
            
            var xhttp = new XMLHttpRequest();
            var data = JSON.stringify(form)
            document.getElementById("x").innerHTML = data;
            xhttp.open("POST", "http://127.0.0.1:8000/form/", true);
            xhttp.setRequestHeader("Content-Type", "application/json"); 
            xhttp.send(data);
        }
        function get_field_data(){
            var table = document.getElementById("myTable");
            var rows_number = document.getElementsByTagName("tr").length;
            var fields = []
            for(i=1; i< rows_number ; i++){
                var obj = {}
                obj = {
                    "name" : table.rows[i].cells[0].children[0].value,
                    "label" : table.rows[i].cells[1].children[0].value,
                    "field_id" : table.rows[1].cells[2].children[0].value,
                    "required" : get_value("required"),
                    "visible" : get_value("visible"),
                    "description" : table.rows[i].cells[5].children[0].value,
                    "min_value" : table.rows[i].cells[6].children[0].value,
                    "max_value" : table.rows[i].cells[7].children[0].value,
                    "default_value" : table.rows[i].cells[8].children[0].value,
                    "placeHolder" : table.rows[i].cells[9].children[0].value
                }
                fields.push(obj);
            }
            return fields;
        }
        function get_value(element_id){
            var checkBox = document.getElementById(element_id);
            if (checkBox.checked == true){
                return true;
            }
            return false;
        }
        
    </script>
</body>
</html>
